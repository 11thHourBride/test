<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SoftFingers - Professional Typing Lessons</title>
  <link rel="canonical" href="https://softfingers-typing.com/lessons.html">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --accent-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --success-gradient: linear-gradient(135deg, #81ffef 0%, #f067b4 100%);
      
      --bg-primary: #0a0e27;
      --bg-secondary: #151932;
      --bg-card: #1e2139;
      --bg-input: #252a41;
      --bg-sidebar: #0d1128;
      
      --text-primary: #ffffff;
      --text-secondary: #b8c5d6;
      --text-muted: #8a9ab0;
      
      --border-subtle: #2d3348;
      --border-accent: #667eea;
      
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.2);
      --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.4);
      --shadow-glow: 0 0 30px rgba(102, 126, 234, 0.3);
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --sidebar-width: 280px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      overflow-x: hidden;
    }

    /* Sidebar Navigation */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      width: var(--sidebar-width);
      height: 100vh;
      background: var(--bg-sidebar);
      border-right: 1px solid var(--border-subtle);
      padding: 2rem 0;
      overflow-y: auto;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .sidebar-header {
      padding: 0 1.5rem 2rem 1.5rem;
      border-bottom: 1px solid var(--border-subtle);
    }

    .sidebar-logo {
      font-size: 1.5rem;
      font-weight: 700;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .sidebar-subtitle {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .sidebar-section {
      padding: 1.5rem 1rem;
    }

    .sidebar-section-title {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin-bottom: 1rem;
      padding: 0 0.5rem;
    }

    .level-nav-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .level-nav-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 3px;
      height: 100%;
      background: var(--primary-gradient);
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }

    .level-nav-item:hover {
      background: var(--bg-secondary);
    }

    .level-nav-item.active {
      background: var(--bg-card);
      box-shadow: var(--shadow-sm);
    }

    .level-nav-item.active::before {
      transform: scaleY(1);
    }

    .level-icon {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    .level-info {
      flex: 1;
    }

    .level-name {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 0.2rem;
    }

    .level-progress {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .level-status {
      font-size: 1rem;
    }

    .stats-overview {
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      padding: 1rem;
      margin: 0 1rem;
    }

    .stat-mini {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--border-subtle);
    }

    .stat-mini:last-child {
      border-bottom: none;
    }

    .stat-mini-label {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .stat-mini-value {
      font-weight: 600;
      font-size: 0.9rem;
    }

    /* Mobile Sidebar Toggle */
    .sidebar-toggle {
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 101;
      background: var(--primary-gradient);
      border: none;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-lg);
      transition: var(--transition);
    }

    .sidebar-toggle:hover {
      transform: scale(1.1);
    }

    /* Main Content Area */
    .main-wrapper {
      flex: 1;
      margin-left: var(--sidebar-width);
      transition: margin-left 0.3s ease;
    }

    /* Header Styles */
    .header {
      background: var(--primary-gradient);
      padding: 2rem;
      text-align: center;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-lg);
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
      animation: headerPulse 8s ease-in-out infinite;
    }

    @keyframes headerPulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    .header-content {
      position: relative;
      z-index: 1;
    }

    .header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .header .subtitle {
      font-size: 1.1rem;
      opacity: 0.9;
      font-weight: 400;
    }

    /* Container */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Card Styles */
    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-subtle);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--primary-gradient);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .card:hover {
      box-shadow: var(--shadow-lg), var(--shadow-glow);
      transform: translateY(-4px);
      border-color: var(--border-accent);
    }

    .card:hover::before {
      transform: scaleX(1);
    }

    .card h2 {
      margin-bottom: 1.5rem;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Progress Section */
    .progress-section {
      background: var(--bg-secondary);
      padding: 1.5rem;
      border-radius: var(--radius-md);
      margin-bottom: 2rem;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .progress-text {
      font-weight: 600;
      color: var(--text-primary);
    }

    .progress-bar-container {
      height: 8px;
      background: var(--bg-input);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: var(--accent-gradient);
      transition: width 0.5s ease;
      width: 0%;
    }

    /* Lesson Area */
    .lesson-container {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .lesson-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--border-subtle);
    }

    .lesson-title {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .lesson-timestamp {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .passage {
      background: var(--bg-card);
      padding: 1.5rem;
      border-radius: var(--radius-md);
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 1.5rem;
      line-height: 1.3;
      margin-bottom: 1.5rem;
      border: 2px solid var(--border-subtle);
      max-height: 120px;
    }

    .typing-input {
      width: 100%;
      padding: 1.5rem;
      font-size: 1.3rem;
      background: var(--bg-input);
      border: 2px solid var(--border-subtle);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-family: 'Monaco', 'Consolas', monospace;
      transition: var(--transition);
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .typing-input:focus {
      outline: none;
      border-color: var(--border-accent);
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2), inset 0 2px 4px rgba(0, 0, 0, 0.2);
      transform: translateY(-2px);
    }

    /* Stats and Controls */
    .lesson-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 2rem;
    }

    .control-group {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius-sm);
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--primary-gradient);
      color: var(--text-primary);
    }

    .btn-secondary {
      background: var(--bg-input);
      color: var(--text-secondary);
      border: 1px solid var(--border-subtle);
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .stat-card {
      background: var(--bg-input);
      padding: 1.25rem;
      border-radius: var(--radius-sm);
      text-align: center;
      border: 1px solid var(--border-subtle);
      position: relative;
      overflow: hidden;
      transition: var(--transition);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: var(--accent-gradient);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
      border-color: var(--border-accent);
    }

    .stat-card:hover::before {
      transform: scaleX(1);
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.5rem;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    /* Keyboard Styles */
    .keyboard-section {
      margin: 3rem 0;
    }

    .keyboard-container {
      background: var(--bg-card);
      padding: 2rem;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
    }

    .keyboard {
      max-width: 800px;
      margin: 0 auto;
    }

    .keyboard-row {
      display: flex;
      justify-content: center;
      gap: 0.25rem;
      margin-bottom: 0.25rem;
    }

    .key {
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      padding: 0.75rem;
      min-width: 2.5rem;
      height: 2.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: inherit;
      font-size: 0.9rem;
      color: var(--text-secondary);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .key:hover {
      background: var(--bg-input);
    }

    .key.active {
      background: var(--accent-gradient);
      color: var(--text-primary);
      box-shadow: var(--shadow-sm);
    }

    .key.wide { min-width: 4rem; }
    .key.xwide { min-width: 6rem; }
    .key.xxwide { min-width: 8rem; }
    .key.space { min-width: 20rem; }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-muted);
    }

    /* Certificate Link */
    .certificate-section {
      text-align: center;
      margin: 3rem 0;
    }

    .cert-btn {
      background: var(--success-gradient);
      color: var(--text-primary);
      padding: 1rem 2rem;
      border-radius: var(--radius-md);
      text-decoration: none;
      font-weight: 600;
      font-size: 1.1rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: var(--transition);
    }

    .cert-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    /* Exercise System Styles */
    .completed {
      border: 2px solid #4ade80 !important;
      background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(34, 197, 94, 0.1)) !important;
    }
    
    .locked {
      border: 2px solid #6b7280 !important;
      background: linear-gradient(135deg, rgba(107, 114, 128, 0.1), rgba(75, 85, 99, 0.1)) !important;
    }

    /* Hidden class */
    .hidden {
      display: none;
    }

    /* Game Card Styles */
    .game-card {
      transition: var(--transition);
      border: 2px solid transparent;
    }

    .game-card:hover {
      border-color: var(--border-accent);
      transform: translateY(-8px) scale(1.02);
      box-shadow: var(--shadow-lg), var(--shadow-glow);
    }

    .game-card h3 {
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Game Canvas Styles */
    #game-canvas {
      position: relative;
      overflow: hidden;
    }

    .falling-word {
      position: absolute;
      background: var(--primary-gradient);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: var(--radius-sm);
      font-weight: 600;
      font-size: 1.1rem;
      transition: top 0.05s linear;
      box-shadow: var(--shadow-md);
    }

    .game-input {
      width: 100%;
      padding: 1rem;
      font-size: 1.2rem;
      background: var(--bg-card);
      border: 2px solid var(--border-subtle);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-family: 'Monaco', 'Consolas', monospace;
      text-align: center;
    }

    .game-input:focus {
      outline: none;
      border-color: var(--border-accent);
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
    }

    img {
      width: 100%;
      max-width: 500px;
      height: auto;
      aspect-ratio: 5 / 4;
      object-fit: cover;
      border-radius: 20px;
      display: block;
      margin: 0 auto;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }

    img.visible {
      opacity: 1;
      transform: translateY(0);
    }

    img:hover {
      transform: scale(1.05) translateY(-8px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.35);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .sidebar-toggle {
        display: flex;
      }

      .main-wrapper {
        margin-left: 0;
      }
      
      .header {
        padding: 1.5rem 1rem;
      }
      
      .header h1 {
        font-size: 1.75rem;
      }

      .header .subtitle {
        font-size: 0.9rem;
      }
      
      .container {
        padding: 1rem;
      }
      
      .card {
        padding: 1.5rem;
      }
      
      .lesson-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }
      
      .lesson-controls {
        grid-template-columns: 1fr;
      }
      
      .key.space {
        min-width: 10rem;
      }
    }

    /* Animation Classes */
    .fade-in {
      opacity: 0;
      animation: fadeIn 0.5s ease forwards;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    .slide-up {
      transform: translateY(20px);
      opacity: 0;
      animation: slideUp 0.5s ease forwards;
    }

    @keyframes slideUp {
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body>
  <!-- Mobile Sidebar Toggle -->
  <button class="sidebar-toggle" id="sidebar-toggle">
    <svg width="24" height="24" fill="white" viewBox="0 0 24 24">
      <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
    </svg>
  </button>

  <!-- Sidebar Navigation -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">SoftFingers</div>
      <div class="sidebar-subtitle">Professional Typing</div>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-section-title">Difficulty Levels</div>
      
      <div class="level-nav-item active" data-level="beginner">
        <div class="level-icon" style="background: linear-gradient(135deg, #4ade80, #22c55e);">
          üå±
        </div>
        <div class="level-info">
          <div class="level-name">Beginner</div>
          <div class="level-progress" id="beginner-progress">0/12 lessons</div>
        </div>
        <div class="level-status">‚úì</div>
      </div>

      <div class="level-nav-item" data-level="intermediate">
        <div class="level-icon" style="background: linear-gradient(135deg, #f59e0b, #f97316);">
          üî•
        </div>
        <div class="level-info">
          <div class="level-name">Intermediate</div>
          <div class="level-progress">Locked</div>
        </div>
        <div class="level-status">üîí</div>
      </div>

      <div class="level-nav-item" data-level="advanced">
        <div class="level-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
          üíé
        </div>
        <div class="level-info">
          <div class="level-name">Advanced</div>
          <div class="level-progress">Locked</div>
        </div>
        <div class="level-status">üîí</div>
      </div>

      <div class="level-nav-item" data-level="games">
        <div class="level-icon" style="background: linear-gradient(135deg, #ec4899, #f43f5e);">
          üéÆ
        </div>
        <div class="level-info">
          <div class="level-name">Games</div>
          <div class="level-progress">Practice & Fun</div>
        </div>
        <div class="level-status">üéØ</div>
      </div>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-section-title">Your Statistics</div>
      <div class="stats-overview">
        <div class="stat-mini">
          <span class="stat-mini-label">Total Time</span>
          <span class="stat-mini-value" id="sidebar-time">0m</span>
        </div>
        <div class="stat-mini">
          <span class="stat-mini-label">Streak</span>
          <span class="stat-mini-value" id="sidebar-streak">0üî•</span>
        </div>
        <div class="stat-mini">
          <span class="stat-mini-label">Completed</span>
          <span class="stat-mini-value" id="sidebar-completed">0</span>
        </div>
        <div class="stat-mini">
          <span class="stat-mini-label">Best WPM</span>
          <span class="stat-mini-value" id="sidebar-best">0</span>
        </div>
      </div>
    </div>

    <div class="sidebar-section">
      <button class="btn btn-secondary" onclick="window.location.href='main.html'" style="width: calc(100% - 2rem); margin: 0 1rem;">
        ‚Üê Dashboard
      </button>
    </div>
  </aside>

  <!-- Main Content Wrapper -->
  <div class="main-wrapper" id="main-wrapper">
    <!-- Header -->
    <div class="header">
      <div class="header-content">
        <h1>Professional Typing Lessons</h1>
        <div class="subtitle">Master touch typing with our comprehensive training program</div>
      </div>
    </div>

    <div class="container">
      <!-- Introduction Card -->
      <div class="card slide-up">
        <h2>Introduction to Touch Typing</h2>
        <p style="margin-bottom: 2rem; font-size: 1.1rem; color: var(--text-secondary);">
          <strong>Touch Typing</strong> is the ability to type without looking at the keyboard. This skill significantly improves your typing speed, accuracy, and reduces physical strain during extended typing sessions.
        </p>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
          <div>
            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Proper Sitting Position</h3>
            <ul style="color: var(--text-secondary); line-height: 1.8;">
              <li>Sit upright with your back straight and shoulders relaxed</li>
              <li>Keep feet flat on the floor with monitor at eye level</li>
              <li>Maintain slightly raised wrists without resting them on the keyboard</li>
              <li>Keep forearms parallel to the floor and take regular breaks</li>
            </ul>
            <img src="correcting-your-sitting-posture-1.jpg" alt="Sitting Posture" />
          </div>
          <div>
            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Hand Positioning</h3>
            <p style="color: var(--text-secondary); line-height: 1.8;">
              Position your hands on the <strong>Home Row</strong>: <strong>A S D F</strong> (left hand) and <strong>J K L ;</strong> (right hand). 
              Keep your thumbs on the <strong>Space</strong> bar and always return to the home row position after pressing each key.
            </p>
            <img src="keybd_hand_position.jpg" alt="Hand Positioning" />
          </div>
        </div>

        <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: var(--radius-md);">
          <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Understanding Typing Metrics</h3>
          <p style="color: var(--text-secondary); line-height: 1.8;">
            <strong>WPM (Words Per Minute)</strong>: Standard measurement where 1 word equals approximately 5 characters.<br>
            <strong>Accuracy</strong>: Percentage of correctly typed characters out of total characters typed.<br>
            <strong>AWPM (Adjusted WPM)</strong>: WPM multiplied by accuracy percentage for a more realistic speed measurement.
          </p>
        </div>
      </div>

      <!-- Lesson Requirements -->
      <div class="card slide-up">
        <h2>Lesson Requirements</h2>
        <div style="background: var(--primary-gradient); color: white; padding: 1.5rem; border-radius: var(--radius-md); text-align: center; font-weight: 600;">
          Pass Requirement: ‚â• 30 WPM and ‚â• 90% Accuracy | 30 exercises per lesson
        </div>
      </div>

      <!-- Active Lesson Area -->
      <div class="lesson-container slide-up">
        <div class="lesson-header" id="lesson-header">
          <div>
            <h2 class="lesson-title" id="lesson-title">Select a lesson to begin</h2>
            <div class="lesson-timestamp" id="lesson-timestamp"></div>
          </div>
        </div>
        
        <!-- Virtual Keyboard -->
        <div class="keyboard-section slide-up">
          <div class="lesson-controls">
            <div class="control-group">
              <button class="btn btn-secondary" id="prev-btn">‚Üê Previous</button>
              <button class="btn btn-secondary" id="next-btn">Next ‚Üí</button>
              <button class="btn btn-primary" id="retry-btn">üîÑ Retry</button>
            </div>

            <div class="stat-card">
              <div class="stat-label">Timer</div>
              <div class="stat-value" id="timer">120s</div>
            </div>

            <div class="stat-card">
              <div class="stat-label">WPM</div>
              <div class="stat-value" id="stat-wpm">0</div>
            </div>

            <div class="stat-card">
              <div class="stat-label">Accuracy</div>
              <div class="stat-value" id="stat-acc">100%</div>
            </div>
          </div>
        </div>
      
        <div class="card">
          <h2 style="text-align: center; margin-bottom: 2rem;">Live Keyboard Guide</h2>
          <div class="passage" id="passage">
            Welcome to SoftFingers Professional Typing Lessons. Select a lesson from the grid below to start your typing journey with 30 exercises per lesson.
          </div>
        
          <input 
            id="typing-input" 
            type="text" 
            class="typing-input" 
            placeholder="Start typing here when lesson begins‚Ä¶" 
            autocomplete="off" 
            spellcheck="false"
          />
          
          <div class="keyboard-container">
            <div class="keyboard">
              <!-- Row 1 -->
              <div class="keyboard-row">
                <div class="key wide" data-code="Backquote">` ~</div>
                <div class="key" data-code="Digit1">1 !</div>
                <div class="key" data-code="Digit2">2 @</div>
                <div class="key" data-code="Digit3">3 #</div>
                <div class="key" data-code="Digit4">4 $</div>
                <div class="key" data-code="Digit5">5 %</div>
                <div class="key" data-code="Digit6">6 ^</div>
                <div class="key" data-code="Digit7">7 &</div>
                <div class="key" data-code="Digit8">8 *</div>
                <div class="key" data-code="Digit9">9 (</div>
                <div class="key" data-code="Digit0">0 )</div>
                <div class="key" data-code="Minus">- _</div>
                <div class="key" data-code="Equal">= +</div>
                <div class="key xwide" data-code="Backspace">Backspace</div>
              </div>
              
              <!-- Row 2 -->
              <div class="keyboard-row">
                <div class="key wide" data-code="Tab">Tab</div>
                <div class="key" data-code="KeyQ">Q</div>
                <div class="key" data-code="KeyW">W</div>
                <div class="key" data-code="KeyE">E</div>
                <div class="key" data-code="KeyR">R</div>
                <div class="key" data-code="KeyT">T</div>
                <div class="key" data-code="KeyY">Y</div>
                <div class="key" data-code="KeyU">U</div>
                <div class="key" data-code="KeyI">I</div>
                <div class="key" data-code="KeyO">O</div>
                <div class="key" data-code="KeyP">P</div>
                <div class="key" data-code="BracketLeft">[ {</div>
                <div class="key" data-code="BracketRight">] }</div>
                <div class="key" data-code="Backslash">\ |</div>
              </div>
              
              <!-- Row 3 -->
              <div class="keyboard-row">
                <div class="key wide" data-code="CapsLock">Caps Lock</div>
                <div class="key" data-code="KeyA">A</div>
                <div class="key" data-code="KeyS">S</div>
                <div class="key" data-code="KeyD">D</div>
                <div class="key" data-code="KeyF">F</div>
                <div class="key" data-code="KeyG">G</div>
                <div class="key" data-code="KeyH">H</div>
                <div class="key" data-code="KeyJ">J</div>
                <div class="key" data-code="KeyK">K</div>
                <div class="key" data-code="KeyL">L</div>
                <div class="key" data-code="Semicolon">; :</div>
                <div class="key" data-code="Quote">' "</div>
                <div class="key xwide" data-code="Enter">Enter</div>
              </div>
              
              <!-- Row 4 -->
              <div class="keyboard-row">
                <div class="key xxwide" data-code="ShiftLeft">Shift</div>
                <div class="key" data-code="KeyZ">Z</div>
                <div class="key" data-code="KeyX">X</div>
                <div class="key" data-code="KeyC">C</div>
                <div class="key" data-code="KeyV">V</div>
                <div class="key" data-code="KeyB">B</div>
                <div class="key" data-code="KeyN">N</div>
                <div class="key" data-code="KeyM">M</div>
                <div class="key" data-code="Comma">, <</div>
                <div class="key" data-code="Period">. ></div>
                <div class="key" data-code="Slash">/ ?</div>
                <div class="key xxwide" data-code="ShiftRight">Shift</div>
              </div>
              
              <!-- Row 5 -->
              <div class="keyboard-row">
                <div class="key wide" data-code="ControlLeft">Ctrl</div>
                <div class="key wide" data-code="MetaLeft">Win</div>
                <div class="key wide" data-code="AltLeft">Alt</div>
                <div class="key space" data-code="Space">Space</div>
                <div class="key wide" data-code="AltRight">Alt</div>
                <div class="key wide" data-code="MetaRight">Win</div>
                <div class="key wide" data-code="ContextMenu">Menu</div>
                <div class="key wide" data-code="ControlRight">Ctrl</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Beginner Section -->
      <div class="section fade-in" id="section-beginner">
        <!-- Progress Section -->
        <div class="progress-section">
          <div class="progress-header">
            <span class="progress-text" id="progress-text">Progress: 0 / 12 lessons | 0 / 360 exercises</span>
            <button class="btn btn-secondary" id="progress-btn">üìä View History</button>
          </div>
          <div class="progress-bar-container">
            <div class="progress-bar" id="progress-bar"></div>
          </div>
        </div>
             
        <!-- Lessons Grid -->
        <div class="card slide-up">
          <h2>Lesson Selection</h2>
          <div id="lessons-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; margin-top: 1rem;">
            <!-- Lessons will be populated by JavaScript -->
          </div>
        </div>

        <!-- Certificate Section -->
        <div class="certificate-section">
          <a href="certificate.html" class="cert-btn">
            üéì View Beginner Certificate
          </a>
        </div>
      </div>

      <!-- Intermediate Section -->
      <div class="section hidden" id="section-intermediate">
        <div class="card">
          <div style="text-align: center; padding: 3rem;">
            <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">üîí</div>
            <h2>Intermediate Lessons</h2>
            <p style="color: var(--text-muted); font-size: 1.1rem;">
              Complete all Beginner lessons with ‚â• 30 WPM & ‚â• 90% accuracy to unlock Intermediate level.
            </p>
          </div>
        </div>
      </div>

      <!-- Advanced Section -->
      <div class="section hidden" id="section-advanced">
        <div class="card">
          <div style="text-align: center; padding: 3rem;">
            <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">üîí</div>
            <h2>Advanced Lessons</h2>
            <p style="color: var(--text-muted); font-size: 1.1rem;">
              Complete all Intermediate lessons to unlock Advanced level training.
            </p>
          </div>
        </div>
      </div>

      <!-- Games Section -->
      <div class="section hidden" id="section-games">
        <!-- Games Header -->
        <div class="card slide-up">
          <h2>üéÆ Typing Games</h2>
          <p style="color: var(--text-secondary); font-size: 1.1rem; margin-bottom: 1rem;">
            Practice your typing skills with fun and engaging games! These games help improve speed, accuracy, and reaction time.
          </p>
        </div>

        <!-- Game Selection Grid -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
          
          <!-- Game 1: Falling Words -->
          <div class="card game-card" data-game="falling-words" style="cursor: pointer;">
            <div style="text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">‚¨áÔ∏è</div>
              <h3 style="margin-bottom: 0.5rem;">Falling Words</h3>
              <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">
                Type words before they reach the bottom! Test your speed under pressure.
              </p>
              <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Speed</span>
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Reaction</span>
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Easy</span>
              </div>
            </div>
          </div>

          <!-- Game 2: Word Race -->
          <div class="card game-card" data-game="word-race" style="cursor: pointer;">
            <div style="text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üèÅ</div>
              <h3 style="margin-bottom: 0.5rem;">Word Race</h3>
              <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">
                Race against time! Type as many words as possible in 60 seconds.
              </p>
              <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Speed</span>
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Endurance</span>
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Medium</span>
              </div>
            </div>
          </div>

          <!-- Game 3: Letter Ninja -->
          <div class="card game-card" data-game="letter-ninja" style="cursor: pointer;">
            <div style="text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">ü•∑</div>
              <h3 style="margin-bottom: 0.5rem;">Letter Ninja</h3>
              <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">
                Hit the correct keys as letters appear! Master keyboard accuracy.
              </p>
              <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Accuracy</span>
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Focus</span>
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Medium</span>
              </div>
            </div>
          </div>

          <!-- Game 4: Typing Destroyer -->
          <div class="card game-card" data-game="typing-destroyer" style="cursor: pointer;">
            <div style="text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üí•</div>
              <h3 style="margin-bottom: 0.5rem;">Typing Destroyer</h3>
              <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">
                Destroy words by typing them correctly! Combo multipliers included.
              </p>
              <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Speed</span>
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Combos</span>
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Hard</span>
              </div>
            </div>
          </div>

          <!-- Game 5: Sentence Challenge -->
          <div class="card game-card" data-game="sentence-challenge" style="cursor: pointer;">
            <div style="text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üìù</div>
              <h3 style="margin-bottom: 0.5rem;">Sentence Challenge</h3>
              <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">
                Type complete sentences accurately. Perfect for real-world practice.
              </p>
              <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Accuracy</span>
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Practical</span>
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Easy</span>
              </div>
            </div>
          </div>

          <!-- Game 6: Typing Marathon -->
          <div class="card game-card" data-game="typing-marathon" style="cursor: pointer;">
            <div style="text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üèÉ</div>
              <h3 style="margin-bottom: 0.5rem;">Typing Marathon</h3>
              <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">
                Endless typing! See how long you can maintain your speed and accuracy.
              </p>
              <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Endurance</span>
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Stamina</span>
                <span style="background: var(--bg-secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Hard</span>
              </div>
            </div>
          </div>

        </div>

        <!-- Game Canvas Container -->
        <div id="game-container" class="card hidden" style="min-height: 500px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h2 id="game-title">Game Title</h2>
            <button class="btn btn-secondary" id="close-game">‚úï Close Game</button>
          </div>
          
          <div id="game-canvas" style="background: var(--bg-secondary); border-radius: var(--radius-md); padding: 2rem; min-height: 400px; position: relative;">
            <!-- Game content will be injected here -->
          </div>

          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem;">
            <div class="stat-card">
              <div class="stat-label">Score</div>
              <div class="stat-value" id="game-score">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Time</div>
              <div class="stat-value" id="game-time">0s</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">WPM</div>
              <div class="stat-value" id="game-wpm">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Accuracy</div>
              <div class="stat-value" id="game-accuracy">100%</div>
            </div>
          </div>
        </div>

        <!-- High Scores -->
        <div class="card">
          <h2>üèÜ Your High Scores</h2>
          <div id="high-scores-container" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
            <!-- High scores will be populated here -->
          </div>
        </div>
      </div>

      <!-- Back Button -->
      <div class="card">
        <button class="btn btn-secondary" id="back-to-lessons">
          ‚Üê Back to Lesson Selection
        </button>
      </div>
    </div>
  </div>

  <!-- Progress Modal -->
  <div id="progress-modal" class="modal">
    <div class="modal-content">
      <span class="close" id="close-progress">&times;</span>
      <h2>üìä Progress History</h2>
      <div class="progress-bar-container" style="margin: 1rem 0;">
        <div class="progress-bar" style="width: 0%;"></div>
      </div>
      <p id="progress-details">Track your learning progress and see detailed statistics for each completed lesson.</p>
      <div id="progress-list">
        <!-- Progress history will be populated here -->
      </div>
    </div>
  </div>
	

 <script>
    // Global state
    let currentLessonIndex = 0;
    let currentExerciseIndex = 0;
    let startTime = null;
    let timerInterval = null;
    let timeLeft = 120;
    let isTyping = false;
    let currentLevel = 'beginner';

    // Enhanced lessons data
    const enhancedLessons = [
      {
        id: 1,
        name: 'Home Row Left Hand',
        category: 'home-row',
        level: 'beginner',
        target_wpm: 20,
        description: 'Master the foundation keys A S D F',
        exercises: [
          'a s d f', 's d f a', 'd f a s', 'f a s d', 'a s a s',
          'a s d a', 'a s d f', 'a s a f', 'a s d f a', 'a d f a s',
          'a f s a s', 'a f d a f', 's a s d', 'd a f s', 'f s a d',
          'd f d a', 's a f d', 'f d s a', 'a d s f', 's f a s',
          'd a s f', 'f s d a', 'a f d s', 's a d f', 'd s f a',
          'f a d s', 'a d a f', 's f s a', 'd f d s', 'f s f a'
        ]
      },
      {
        id: 2,
        name: 'Home Row Right Hand',
        category: 'home-row',
        level: 'beginner',
        target_wpm: 20,
        description: 'Master the foundation keys J K L ;',
        exercises: [
          'j k l ;', 'k l ; j', 'l ; j k', '; j k l', 'j k j k',
          'j k l j', 'j k l ;', 'j k j ;', 'j k l ; j', 'j l ; j k',
          'j ; k j k', 'j ; l j ;', 'k j k l', 'l j ; k', '; k j l',
          'l ; l j', 'k j ; l', '; l k j', 'j l k ;', 'k ; j k',
          'l j k ;', '; k l j', 'j ; l k', 'k j l ;', 'l k ; j',
          '; j l k', 'j l j ;', 'k ; k j', 'l ; l k', '; k ; j'
        ]
      },
      {
        id: 3,
        name: 'Home Row Complete',
        category: 'home-row',
        level: 'beginner',
        target_wpm: 25,
        description: 'Combine both hands on home row',
        exercises: [
          'asdf jkl; asdf jkl;', 'fff jjj fff jjj', 'ddd kkk ddd kkk',
          'sss lll sss lll', 'aaa ;;; aaa ;;;', 'fd jk fd jk',
          'sa l; sa l;', 'af jk af jk', 'ds kl ds kl', 'ask ask ask',
          'lad lad lad', 'sad sad sad', 'fall fall fall', 'ask a lad; ask a lad;',
          'a sad dad; a sad dad;', 'fall ask fall ask', 'lads ask lads;',
          'a flask; a flask;', 'dad has a flask;', 'sad lads fall;',
          'ask dad; fall lads;', 'a lass has a flask;', 'falls ask lads;',
          'flash flash flash', 'slash slash slash', 'dads ask; lads fall;',
          'a sad lass asks dad;', 'fall; ask; sad; lads;', 'dad asks a sad lass;',
          'ask lads; fall flask;'
        ]
      },
      {
        id: 4,
        name: 'Home Row Mastery',
        category: 'home-row',
        level: 'beginner',
        target_wpm: 28,
        description: 'Advanced home row combinations',
        exercises: [
          'glass glass glass', 'class class class', 'shall shall shall',
          'lass lass lass', 'flask flask flask', 'slash slash slash',
          'flash flash flash', 'ask a class;', 'a glass flask;',
          'shall ask; shall fall;', 'dad has a glass;', 'a lass asks;',
          'flash; slash; glass;', 'lads shall ask;', 'a sad class falls;',
          'ask dads; slash glass;', 'shall flash; shall slash;',
          'a flask has glass;', 'sad lass asks dad;', 'fall flash; ask glass;',
          'dads shall ask a lass;', 'glass flask falls;', 'ask; fall; flash;',
          'a class shall ask;', 'sad dads fall; lads flash;', 'flask glass; slash ask;',
          'shall a lass ask dad?', 'flash glass slash;', 'ask class; fall flask;',
          'a glass flask shall fall;'
        ]
      },
      {
        id: 5,
        name: 'Upper Row Q W E R',
        category: 'upper-row',
        level: 'beginner',
        target_wpm: 26,
        description: 'Learn Q W E R keys',
        exercises: [
          'qqq www eee rrr', 'qwe qwe qwe', 'req req req',
          'wer wer wer', 'qwer qwer qwer', 'were were were',
          'wear wear wear', 'dear dear dear', 'read read read',
          'real real real', 'dale dale dale', 'ware ware ware',
          'earl earl earl', 'rade rade rade', 'we are; we are;',
          'read a dear;', 'wear real;', 'a dear earl;',
          'we read; we wear;', 'earl reads;', 'dear dale wears;',
          'we are real;', 'a dear reads;', 'wear red; read dear;',
          'earl wears; dale reads;', 'we read a dear earl;',
          'real ware; dear read;', 'a red earl reads;', 'dear dale; real earl;',
          'we wear real red;'
        ]
      },
      {
        id: 6,
        name: 'Upper Row Complete',
        category: 'upper-row',
        level: 'beginner',
        target_wpm: 30,
        description: 'Master T Y U I O P keys',
        exercises: [
          'ttt yyy uuu iii ooo ppp', 'tyu tyu tyu', 'iop iop iop',
          'tyui tyui tyui', 'yiop yiop yiop', 'quit quit quit',
          'your your your', 'port port port', 'type type type',
          'troy troy troy', 'pity pity pity', 'pour pour pour',
          'tour tour tour', 'riot riot riot', 'port your;',
          'type a quit;', 'your port; tour pity;', 'pour troy; riot port;',
          'quit your tour;', 'type port; your riot;', 'troy pours; pity quits;',
          'your tour port;', 'riot type; pour quit;', 'port pity troy;',
          'quit your riot;', 'type tour pours;', 'your pity port;',
          'riot quits; troy tours;', 'pour type; quit tour;',
          'your troy port quits;'
        ]
      },
      {
        id: 7,
        name: 'Bottom Row Z X C V',
        category: 'bottom-row',
        level: 'beginner',
        target_wpm: 24,
        description: 'Learn Z X C V keys',
        exercises: [
          'zzz xxx ccc vvv', 'zxc zxc zxc', 'xcv xcv xcv',
          'zxcv zxcv zxcv', 'cave cave cave', 'coax coax coax',
          'vex vex vex', 'czar czar czar', 'zeal zeal zeal',
          'zero zero zero', 'axis axis axis', 'civic civic civic',
          'voice voice voice', 'crave crave crave', 'cave zero;',
          'vex czar; coax voice;', 'zero axis; cave civic;',
          'crave zeal; voice coax;', 'czar caves; zero voices;',
          'vex civic; coax cave;', 'zero craves; axis voices;',
          'cave czar; vex zeal;', 'civic voice; coax zero;',
          'crave axis; cave vex;', 'zero civic czar;', 'vex voice; coax crave;',
          'cave axis; czar zero;', 'civic craves; voice coax;',
          'zero vex; cave voice;'
        ]
      },
      {
        id: 8,
        name: 'Bottom Row Complete',
        category: 'bottom-row',
        level: 'beginner',
        target_wpm: 28,
        description: 'Master B N M keys',
        exercises: [
          'bbb nnn mmm', 'bnm bnm bnm', 'mnb mnb mnb',
          'been been been', 'name name name', 'come come come',
          'beam beam beam', 'moon moon moon', 'bone bone bone',
          'mean mean mean', 'boom boom boom', 'room room room',
          'main main main', 'norm norm norm', 'been name;',
          'come beam; moon bone;', 'mean boom; room main;',
          'norm comes; beam moons;', 'name been; bone mean;',
          'come room; main boom;', 'moon beam; norm name;',
          'been main; come norm;', 'boom room; bone beam;',
          'name moon; mean come;', 'norm been boom;', 'come main beam;',
          'moon room; bone name;', 'been boom; mean norm;',
          'come bone; name beam;'
        ]
      },
      {
        id: 9,
        name: 'Three Row Integration',
        category: 'combined',
        level: 'beginner',
        target_wpm: 32,
        description: 'Combine all keyboard rows',
        exercises: [
          'quick brown fox;', 'jumps over lazy;', 'the dog runs;',
          'brown fox jumps;', 'quick lazy dog;', 'over the brown;',
          'fox runs quick;', 'lazy dog jumps;', 'the quick fox;',
          'brown dog over;', 'jumps lazy fox;', 'quick brown runs;',
          'the fox over;', 'lazy jumps dog;', 'brown quick fox;',
          'the dog jumps over;', 'quick brown lazy fox;', 'over the quick dog;',
          'fox jumps brown;', 'lazy the over;', 'quick dog brown fox;',
          'jumps over the lazy;', 'brown fox quick dog;', 'the lazy jumps;',
          'over quick brown;', 'fox dog lazy;', 'the quick brown fox jumps;',
          'over the lazy dog;', 'brown quick fox;', 'jumps lazy over the;'
        ]
      },
      {
        id: 10,
        name: 'Numbers 1-5',
        category: 'numbers',
        level: 'beginner',
        target_wpm: 28,
        description: 'Learn numbers 1 2 3 4 5',
        exercises: [
          '111 222 333 444 555', '12345 12345 12345', '54321 54321 54321',
          '1234 1234 1234', '5432 5432 5432', '123 321 123 321',
          '45 54 45 54', '135 531 135 531', '24 42 24 42',
          '1 cat 2 dogs 3 birds', '5 apples 4 oranges', '12 hours 34 minutes',
          'room 123 has 45 chairs', 'call 555-1234 for help', 'buy 2 books 4 pens',
          'drive 15 miles in 23 minutes', 'score 12 points in 34 seconds',
          '5 teams 4 games 3 wins', 'page 123 line 45 word 1', 'add 12 plus 34 equals 46',
          '1st place 2nd runner', '4 cups 5 spoons 3 plates', 'meet at 12:34 in room 15',
          '25 students 13 teachers', '1 dog 2 cats 3 birds play', 'dial 123-4567 extension 15',
          '54 degrees 32 minutes north', '123 main street apartment 45',
          '1 plus 2 plus 3 equals 6', '5 minutes 4 hours 3 days'
        ]
      },
      {
        id: 11,
        name: 'Numbers 6-0',
        category: 'numbers',
        level: 'beginner',
        target_wpm: 30,
        description: 'Complete number row 6 7 8 9 0',
        exercises: [
          '666 777 888 999 000', '67890 67890 67890', '09876 09876 09876',
          '6789 6789 6789', '0987 0987 0987', '678 876 678 876',
          '90 09 90 09', '679 976 679 976', '80 08 80 08',
          '6 cars 7 bikes 8 trucks', '70 degrees 89 humidity', '678 west avenue apartment 90',
          'call 890-6789 between 6 and 7', 'buy 6 apples 7 oranges 8 bananas',
          'score 67 to 89 in 90 minutes', 'drive 678 miles in 90 hours',
          '8 teams 9 games 7 wins', 'page 678 line 90 word 6', '60 plus 78 plus 9 equals 147',
          '6th grade 7th period 8th chapter', '9 cups 8 spoons 7 plates',
          'meet at 6:30 today', '89 students 67 teachers', '6 dogs 7 cats 8 birds run',
          'dial 678-9012 extension 60', '89 degrees 67 minutes south',
          '6789 oak street apartment 0', '6 plus 7 plus 8 equals 21',
          '90 minutes 8 hours 7 days', '1234567890 all numbers'
        ]
      },
      {
        id: 12,
        name: 'Basic Punctuation',
        category: 'punctuation',
        level: 'beginner',
        target_wpm: 32,
        description: 'Master . , ? ! ; : " \'',
        exercises: [
          '... ,,, ??? !!! ;;; ::: """ \'\'\'', 'hello, world. how are you?',
          'i am fine, thank you!', 'what time is it? 3:30 pm.', 'she said, "hello there."',
          'don\'t worry; all okay.', 'yes, i can help you.', 'where are you going? home.',
          'stop! look both ways.', 'the cat, dog, and bird.', '"are you ready?" she asked.',
          'no, i can\'t go; work.', 'wow! that\'s amazing news.', 'please, sit down now.',
          'what\'s your name? john.', 'i love pizza, pasta, cream.', '"hello," he said kindly.',
          'stop, look, listen; cross.', 'yes! we won the game.', 'she can\'t come; busy.',
          'what time? when? where?', 'i said, "please wait here."', 'don\'t run; walk slowly.',
          'great! that\'s what we need.', 'the book, pen, and paper.', '"good morning," she smiled.',
          'i won\'t go; too late.', 'help! call for assistance!', 'he asked, "can you help?"',
          'wait; let me think carefully.'
        ]
      }
    ];

    // Progress data
    let progressData = JSON.parse(localStorage.getItem('typingProgress')) || {
      completedLessons: [],
      bestScores: {},
      totalTime: 0,
      streak: 0,
      exerciseProgress: {},
      unlockedLessons: [1]
    };

    // DOM references
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebar-toggle');
    const mainWrapper = document.getElementById('main-wrapper');
    const lessonsGrid = document.getElementById('lessons-grid');
    const keys = document.querySelectorAll('.key');
    const typingInput = document.getElementById('typing-input');
    const passageEl = document.getElementById('passage');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const retryBtn = document.getElementById('retry-btn');
    const progressBtn = document.getElementById('progress-btn');
    const progressModal = document.getElementById('progress-modal');
    const closeProgress = document.getElementById('close-progress');

    // Sidebar functionality
    if (sidebarToggle) {
      sidebarToggle.addEventListener('click', () => {
        sidebar.classList.toggle('open');
      });
    }

    if (mainWrapper) {
      mainWrapper.addEventListener('click', (e) => {
        if (window.innerWidth <= 768 && sidebar.classList.contains('open')) {
          if (!sidebar.contains(e.target) && e.target !== sidebarToggle) {
            sidebar.classList.remove('open');
          }
        }
      });
    }

    // Level navigation
    document.querySelectorAll('.level-nav-item').forEach(item => {
      item.addEventListener('click', () => {
        const level = item.getAttribute('data-level');
        
        document.querySelectorAll('.level-nav-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        
        document.querySelectorAll('.section').forEach(section => section.classList.add('hidden'));
        const targetSection = document.getElementById(`section-${level}`);
        if (targetSection) {
          targetSection.classList.remove('hidden');
        }
        
        currentLevel = level;
        
        // Hide/show lesson container based on level
        const lessonContainer = document.querySelector('.lesson-container');
        if (lessonContainer) {
          if (level === 'intermediate' || level === 'advanced') {
            lessonContainer.style.display = 'none';
            typingInput.disabled = true;
          } else if (level === 'beginner') {
            lessonContainer.style.display = 'block';
            typingInput.disabled = false;
          } else if (level === 'games') {
            lessonContainer.style.display = 'none';
          }
        }
        
        if (window.innerWidth <= 768) {
          sidebar.classList.remove('open');
        }
      });
    });

    // Update sidebar stats
    function updateSidebarStats() {
      const totalMinutes = Math.round(progressData.totalTime / 60);
      const sidebarTime = document.getElementById('sidebar-time');
      const sidebarStreak = document.getElementById('sidebar-streak');
      const sidebarCompleted = document.getElementById('sidebar-completed');
      const sidebarBest = document.getElementById('sidebar-best');
      
      if (sidebarTime) sidebarTime.textContent = totalMinutes + 'm';
      if (sidebarStreak) sidebarStreak.textContent = progressData.streak + 'üî•';
      if (sidebarCompleted) sidebarCompleted.textContent = progressData.completedLessons.length;
      
      let bestWPM = 0;
      Object.values(progressData.bestScores).forEach(score => {
        if (score.wpm > bestWPM) bestWPM = score.wpm;
      });
      if (sidebarBest) sidebarBest.textContent = bestWPM;

     const completed = progressData.completedLessons.length;
      const total = enhancedLessons.length;

      let totalExercisesCompleted = 0;
      let totalExercises = 0;

      // Filter out any undefined or null lessons
      const validLessons = enhancedLessons.filter(lesson => lesson != null);

      validLessons.forEach(lesson => {
        totalExercises += lesson.exercises.length;
        const exProg = progressData.exerciseProgress[lesson.id] || [];
        totalExercisesCompleted += exProg.length;
      });

      const progressText = document.getElementById('progress-text');
      if (progressText) {
        progressText.textContent = `Progress: ${completed}/${total} lessons | ${totalExercisesCompleted}/${totalExercises} exercises`;
      }

      const progressBar = document.getElementById('progress-bar');

    // Utility functions
    function lessonIndexById(id) {
      return enhancedLessons.findIndex(l => l.id === id);
    }

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // Populate lessons grid
    function populateLessonsGrid() {
      if (!lessonsGrid) return;
      
      lessonsGrid.innerHTML = '';

      const categories = {
        'home-row': { name: 'Home Row Training', lessons: [] },
        'upper-row': { name: 'Upper Row Training', lessons: [] },
        'bottom-row': { name: 'Bottom Row Training', lessons: [] },
        'combined': { name: 'Multi-Row Combinations', lessons: [] },
        'numbers': { name: 'Numbers & Digits', lessons: [] },
        'punctuation': { name: 'Punctuation & Symbols', lessons: [] }
      };

      enhancedLessons.forEach(lesson => {
        if (categories[lesson.category]) categories[lesson.category].lessons.push(lesson);
      });

      Object.keys(categories).forEach(catKey => {
        const cat = categories[catKey];
        if (!cat.lessons.length) return;

        const catHeader = document.createElement('div');
        catHeader.style.cssText = `
          grid-column: 1 / -1;
          margin: 2rem 0 1rem 0;
          padding: 1rem;
          background: var(--primary-gradient);
          border-radius: var(--radius-md);
          text-align: center;
          font-weight: 600;
          font-size: 1.1rem;
        `;
        catHeader.innerHTML = `
          <div>${cat.name}</div>
          <div style="font-size: 0.8rem; opacity: 0.9; margin-top: 0.5rem;">
            ${cat.lessons.length} lesson${cat.lessons.length > 1 ? 's' : ''} ‚Ä¢ 30 exercises each
          </div>
        `;
        lessonsGrid.appendChild(catHeader);

       cat.lessons.forEach(lesson => {
 const lessonCard = document.createElement('div');
  const isCompleted = progressData?.completedLessons?.includes(lesson.id) ?? false;
  const exerciseProg = progressData?.exerciseProgress?.[lesson.id] ?? [];
  const completedExercises = exerciseProg.length;
  const bestScore = progressData?.bestScores?.[lesson.id];
  const isLocked = !progressData?.unlockedLessons?.includes(lesson.id) ?? true; 

  lessonCard.className = `stat-card ${isCompleted ? 'completed' : ''} ${isLocked ? 'locked' : ''}`;
  lessonCard.style.cursor = isLocked ? 'not-allowed' : 'pointer';
  lessonCard.style.opacity = isLocked ? '0.5' : '1';

  

  const categoryColors = {
    'home-row': '#4ade80',
    'upper-row': '#3b82f6', 
    'bottom-row': '#f59e0b',
    'combined': '#8b5cf6',
    'numbers': '#ef4444',
    'punctuation': '#10b981'
  };

  // Ensure lesson has exercises array
  const exercisesLength = lesson.exercises ? lesson.exercises.length : 30;
  const progressPercentage = exercisesLength > 0 ? (completedExercises / exercisesLength) * 100 : 0;

  lessonCard.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
      <div class="stat-label">Lesson ${lesson.id}</div>
      <div style="width: 12px; height: 12px; border-radius: 50%; background: ${categoryColors[lesson.category] || '#6b7280'};"></div>
    </div>
    <div class="stat-value" style="font-size: 0.9rem; margin-bottom: 0.5rem;">
      ${lesson.name}
      ${isLocked ? ' üîí' : ''}
    </div>
    <div style="font-size: 0.7rem; color: var(--text-muted); line-height: 1.4;">
      ${lesson.description || ''}
    </div>
    <div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.5rem;">
      Target: ${lesson.target_wpm || 30} WPM ‚Ä¢ ${exercisesLength} exercises
    </div>
    <div style="margin-top: 0.5rem;">
      <div style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 0.3rem;">
        Progress: ${completedExercises}/${exercisesLength}
      </div>
      <div style="width: 100%; height: 4px; background: var(--bg-input); border-radius: 2px; overflow: hidden;">
        <div style="height: 100%; background: ${categoryColors[lesson.category]}; width: ${progressPercentage}%; transition: width 0.3s ease;"></div>
      </div>
    </div>
    ${bestScore ? `
      <div style="font-size: 0.7rem; color: ${categoryColors[lesson.category]}; margin-top: 0.5rem;">
        Best: ${bestScore.wpm} WPM (${bestScore.accuracy}%)
      </div>
    ` : ''}
    ${isCompleted ? `
      <div style="font-size: 0.8rem; color: #4ade80; margin-top: 0.5rem;">
        ‚úì Completed
      </div>
    ` : isLocked ? `
      <div style="font-size: 0.7rem; color: #ef4444; margin-top: 0.5rem;">
        Complete previous lessons
      </div>
    ` : completedExercises > 0 ? `
      <div style="font-size: 0.7rem; color: #f59e0b; margin-top: 0.5rem;">
        üìö In Progress
      </div>
    ` : ''}
  `;

  // Add click event
  lessonCard.addEventListener('click', function() {
    if (isLocked) {
      alert('Please complete previous lessons to unlock this lesson.');
    } else {
      const idx = lessonIndexById(lesson.id);
      if (idx >= 0) {
        loadLesson(idx);
      }
    }
  });

  lessonsGrid.appendChild(lessonCard);
});
});
		}

    // Update progress display
    function updateProgressDisplay() {
      const completed = progressData.completedLessons.length;
      const total = enhancedLessons.length;

      let totalExercisesCompleted = 0;
      let totalExercises = 0;

      enhancedLessons.forEach(lesson => {
        console.log(lesson); 
        totalExercises += lesson.exercises.length;
        const exProg = progressData.exerciseProgress[lesson.id] || [];
        totalExercisesCompleted += exProg.length;
      });


      const progressText = document.getElementById('progress-text');
      if (progressText) {
        progressText.textContent = `Progress: ${completed}/${total} lessons | ${totalExercisesCompleted}/${totalExercises} exercises`;
      }

      const progressBar = document.getElementById('progress-bar');
      if (progressBar) {
        const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
        progressBar.style.width = percentage + '%';
      }

      updateSidebarStats();
    }

    // Progress modal
    function updateProgressModal() {
      const progressList = document.getElementById('progress-list');
      if (!progressList) return;
      
      progressList.innerHTML = '';

      enhancedLessons.forEach(lesson => {
        const isCompleted = progressData.completedLessons.includes(lesson.id);
        const exerciseProgress = progressData.exerciseProgress[lesson.id] || [];
        const completedExercises = exerciseProgress.length;
        const bestScore = progressData.bestScores[lesson.id];

        const listItem = document.createElement('div');
        listItem.style.cssText = `
          padding: 1rem;
          margin: 0.5rem 0;
          background: var(--bg-secondary);
          border-radius: 8px;
          border-left: 4px solid ${isCompleted ? '#4ade80' : completedExercises > 0 ? '#f59e0b' : '#6b7280'};
        `;

        listItem.innerHTML = `
          <div style="font-weight: 600; margin-bottom: 0.5rem;">${lesson.name}</div>
          <div style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0.5rem;">${lesson.description}</div>
          <div style="font-size: 0.8rem; color: var(--text-secondary);">
            Progress: ${completedExercises}/${lesson.exercises.length} exercises completed
          </div>
          <div style="width: 100%; height: 6px; background: var(--bg-input); border-radius: 3px; margin: 0.5rem 0;">
            <div style="height: 100%; background: ${isCompleted ? '#4ade80' : '#f59e0b'}; width: ${(completedExercises / lesson.exercises.length) * 100}%; border-radius: 3px; transition: width 0.3s ease;"></div>
          </div>
          ${bestScore ? 
            `<div style="margin-top: 0.5rem; font-size: 0.8rem; color: var(--text-secondary);">
              Best Score: ${bestScore.wpm} WPM, ${bestScore.accuracy}% accuracy
            </div>` : 
            '<div style="margin-top: 0.5rem; font-size: 0.8rem; color: #ef4444;">Not started</div>'
          }
        `;
        progressList.appendChild(listItem);
      });

      const totalExercises = enhancedLessons.reduce((sum, l) => sum + l.exercises.length, 0);const completedExercises = Object.values(progressData.exerciseProgress).reduce((sum, arr) => sum + arr.length, 0);

      const progressDetails = document.getElementById('progress-details');
      if (progressDetails) {
        progressDetails.innerHTML = `
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin: 1rem 0;">
            <div style="text-align: center; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
              <div style="font-size: 1.5rem; font-weight: 700;">${progressData.completedLessons.length}</div>
              <div style="font-size: 0.8rem; color: var(--text-muted);">Lessons Completed</div>
            </div>
            <div style="text-align: center; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
              <div style="font-size: 1.5rem; font-weight: 700;">${completedExercises}</div>
              <div style="font-size: 0.8rem; color: var(--text-muted);">Exercises Completed</div>
            </div>
            <div style="text-align: center; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
              <div style="font-size: 1.5rem; font-weight: 700;">${Math.round(progressData.totalTime / 60)}</div>
              <div style="font-size: 0.8rem; color: var(--text-muted);">Minutes Practiced</div>
            </div>
            <div style="text-align: center; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
              <div style="font-size: 1.5rem; font-weight: 700;">${progressData.streak}</div>
              <div style="font-size: 0.8rem; color: var(--text-muted);">Current Streak</div>
            </div>
          </div>
        `;
      }
    }

    // Keyboard highlight
    function highlightKey(keyCode) {
      keys.forEach(key => key.classList.remove('active'));
      const targetKey = document.querySelector(`[data-code="${keyCode}"]`);
      if (targetKey) {
        targetKey.classList.add('active');
        setTimeout(() => targetKey.classList.remove('active'), 500);
      }
    }

    // Load lesson
    function loadLesson(lessonIndex) {
      currentLessonIndex = lessonIndex;
      const lesson = enhancedLessons[lessonIndex];

      if (!progressData.exerciseProgress[lesson.id]) {
        progressData.exerciseProgress[lesson.id] = [];
      }

      currentExerciseIndex = 0;
      
      // Show lesson container and enable input for beginner lessons
      const lessonContainer = document.querySelector('.lesson-container');
      if (lessonContainer) {
        lessonContainer.style.display = 'block';
      }
      
      loadExercise();
      updateNavigationButtons();
      populateLessonsGrid();
      updateProgressDisplay();
    }

    // Load exercise
    function loadExercise() {
      const lesson = enhancedLessons[currentLessonIndex];
      const exercise = lesson.exercises[currentExerciseIndex];

      const lessonTitle = document.getElementById('lesson-title');
      if (lessonTitle) {
        lessonTitle.textContent = `Lesson ${lesson.id}: ${lesson.name} (${currentExerciseIndex + 1}/${lesson.exercises.length})`;
      }

      const lessonTimestamp = document.getElementById('lesson-timestamp');
      if (lessonTimestamp) {
        lessonTimestamp.textContent = `Target: ${lesson.target_wpm} WPM | Exercise ${currentExerciseIndex + 1} | ${new Date().toLocaleTimeString()}`;
      }

      if (passageEl) {
        passageEl.textContent = exercise;
      }
      
      resetLesson();
      highlightCurrentCharacter();
      
      if (typingInput) {
        typingInput.focus();
      }
      
      updateNavigationButtons();
    }

    // Update navigation buttons
    function updateNavigationButtons() {
      const lesson = enhancedLessons[currentLessonIndex];
      if (prevBtn) {
        prevBtn.disabled = currentLessonIndex === 0 && currentExerciseIndex === 0;
      }
      if (nextBtn) {
        nextBtn.disabled = currentLessonIndex === enhancedLessons.length - 1 && 
                          currentExerciseIndex === lesson.exercises.length - 1;
      }
    }

    // Highlight current character
    function highlightCurrentCharacter() {
      if (!typingInput || !passageEl) return;
      
      const typed = typingInput.value || '';
      const currentExercise = enhancedLessons[currentLessonIndex].exercises[currentExerciseIndex];
      let html = '';

      for (let i = 0; i < currentExercise.length; i++) {
        const ch = currentExercise[i];
        if (i < typed.length) {
          if (typed[i] === ch) {
            html += `<span style="background-color: #4ade80; color: #000;">${escapeHtml(ch)}</span>`;
          } else {
            html += `<span style="background-color: #ef4444; color: #fff;">${escapeHtml(ch)}</span>`;
          }
        } else if (i === typed.length) {
          html += `<span style="background-color: #3b82f6; color: #fff; animation: pulse 1s infinite;">${escapeHtml(ch)}</span>`;
        } else {
          html += escapeHtml(ch);
        }
      }

      passageEl.innerHTML = html;
    }

    // Update stats
    function updateStats() {
      if (!typingInput) return;
      
      const typed = typingInput.value;
      const currentExercise = enhancedLessons[currentLessonIndex].exercises[currentExerciseIndex];
      if (!startTime) return;

      let correct = 0;
      for (let i = 0; i < typed.length; i++) {
        if (typed[i] === currentExercise[i]) correct++;
      }
      const accuracy = typed.length > 0 ? Math.round((correct / typed.length) * 100) : 100;
      const statAcc = document.getElementById('stat-acc');
      if (statAcc) statAcc.textContent = accuracy + '%';

      const timeElapsedMinutes = (new Date() - startTime) / 1000 / 60;
      const wordsTyped = correct / 5;
      const wpm = timeElapsedMinutes > 0 ? Math.round(wordsTyped / timeElapsedMinutes) : 0;
      const statWpm = document.getElementById('stat-wpm');
      if (statWpm) statWpm.textContent = wpm;
    }

    // Complete exercise
    function completeExercise(isTimeUp = false) {
      clearInterval(timerInterval);
      if (typingInput) typingInput.disabled = true;

      const timeElapsed = (new Date() - startTime) / 1000;
      const typed = typingInput.value;
      let correct = 0;
      const currentExercise = enhancedLessons[currentLessonIndex].exercises[currentExerciseIndex];
      for (let i = 0; i < typed.length; i++) {
        if (typed[i] === currentExercise[i]) correct++;
      }
      const accuracy = typed.length > 0 ? Math.round((correct / typed.length) * 100) : 100;
      const wpm = timeElapsed > 0 ? Math.round((correct / 5) / (timeElapsed / 60)) : 0;

      const lesson = enhancedLessons[currentLessonIndex];
      const passed = wpm >= lesson.target_wpm && accuracy >= 90 && !isTimeUp;

      showExerciseResults(wpm, accuracy, passed, timeElapsed);
      
      if (passed) {
        saveExerciseProgress(lesson.id, currentExerciseIndex, wpm, accuracy, timeElapsed);
        setTimeout(() => {
          if (currentExerciseIndex < lesson.exercises.length - 1) {
            currentExerciseIndex++;
            loadExercise();
          } else {
            completeLessonFully();
          }
        }, 1500);
      } else {
        setTimeout(() => {
          if (typingInput) typingInput.disabled = false;
          resetLesson();
          highlightCurrentCharacter();
          if (typingInput) typingInput.focus();
        }, 2000);
      }
    }

    // Show results
    function showExerciseResults(wpm, accuracy, passed, time) {
      const lesson = enhancedLessons[currentLessonIndex];
      const exerciseNum = currentExerciseIndex + 1;
      const total = lesson.exercises.length;

      if (passed) {
        alert(`Exercise ${exerciseNum}/${total} Complete!\n\nWPM: ${wpm}\nAccuracy: ${accuracy}%\nTime: ${Math.round(time)}s\n\nAdvancing to next exercise...`);
      } else {
        alert(`Try Again!\nWPM: ${wpm} (need ‚â• ${lesson.target_wpm})\nAccuracy: ${accuracy}% (need ‚â• 90%)\n\nRestarting exercise...`);
      }
    }

    // Save progress
    function saveExerciseProgress(lessonId, exerciseIndex, wpm, accuracy, time) {
      if (!progressData.exerciseProgress[lessonId]) {
        progressData.exerciseProgress[lessonId] = [];
      }
      if (!progressData.exerciseProgress[lessonId].includes(exerciseIndex)) {
        progressData.exerciseProgress[lessonId].push(exerciseIndex);
      }

      if (!progressData.bestScores[lessonId] || wpm > progressData.bestScores[lessonId].wpm) {
        progressData.bestScores[lessonId] = { wpm, accuracy, time };
      }

      progressData.totalTime += time;
      localStorage.setItem('typingProgress', JSON.stringify(progressData));
      updateProgressDisplay();
      updateSidebarStats();
      populateLessonsGrid();
    }

    // Complete lesson
    function completeLessonFully() {
      const lesson = enhancedLessons[currentLessonIndex];
      const completed = progressData.exerciseProgress[lesson.id] || [];
      
      if (completed.length >= lesson.exercises.length && !progressData.completedLessons.includes(lesson.id)) {
        progressData.completedLessons.push(lesson.id);
        progressData.streak = (progressData.streak || 0) + 1;

        const nextLesson = enhancedLessons[currentLessonIndex + 1];
        if (nextLesson && !progressData.unlockedLessons.includes(nextLesson.id)) {
          progressData.unlockedLessons.push(nextLesson.id);
        }

        localStorage.setItem('typingProgress', JSON.stringify(progressData));
        populateLessonsGrid();
        updateProgressDisplay();

        alert(`Congratulations! Lesson ${lesson.id} Completed!\n\nYou've mastered all ${lesson.exercises.length} exercises!\n${nextLesson ? 'Next lesson unlocked!' : 'All lessons completed!'}`);
        
        if (nextLesson) {
          setTimeout(() => loadLesson(currentLessonIndex + 1), 2000);
        }
      }
    }

    // Reset lesson
    function resetLesson() {
      if (typingInput) {
        typingInput.value = '';
        typingInput.disabled = false;
      }
      
      timeLeft = 120;
      startTime = null;
      isTyping = false;

      const timerEl = document.getElementById('timer');
      const statWpm = document.getElementById('stat-wpm');
      const statAcc = document.getElementById('stat-acc');
      
      if (timerEl) timerEl.textContent = '120s';
      if (statWpm) statWpm.textContent = '0';
      if (statAcc) statAcc.textContent = '100%';

      clearInterval(timerInterval);
    }

    // Start timer
    function startTimer() {
      if (isTyping) return;
      isTyping = true;
      startTime = startTime || new Date();
      timerInterval = setInterval(() => {
        timeLeft--;
        const timerEl = document.getElementById('timer');
        if (timerEl) timerEl.textContent = timeLeft + 's';
        
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          if (typingInput) typingInput.disabled = true;
          alert('Time\'s up! You can retry this exercise.');
          setTimeout(() => {
            resetLesson();
            highlightCurrentCharacter();
            if (typingInput) typingInput.focus();
          }, 1000);
        }
      }, 1000);
    }

    // Event listeners
    if (typingInput) {
      typingInput.addEventListener('input', () => {
        if (!startTime) startTime = new Date();
        startTimer();
        highlightCurrentCharacter();
        updateStats();

        const current = enhancedLessons[currentLessonIndex].exercises[currentExerciseIndex];
        if (typingInput.value === current) {
          completeExercise();
        }
      });

      typingInput.addEventListener('blur', function() {
        setTimeout(() => {
          if (!typingInput.disabled && currentLevel === 'beginner') {
            typingInput.focus();
          }
        }, 100);
      });

      typingInput.addEventListener('paste', function(e) {
        e.preventDefault();
        alert('Pasting is not allowed. Please type manually.');
      });
    }

    if (prevBtn) {
      prevBtn.addEventListener('click', () => {
        if (currentExerciseIndex > 0) {
          currentExerciseIndex--;
          loadExercise();
        } else if (currentLessonIndex > 0) {
          const prevLessonIndex = currentLessonIndex - 1;
          const prevLesson = enhancedLessons[prevLessonIndex];
          if (progressData.unlockedLessons.includes(prevLesson.id)) {
            currentLessonIndex = prevLessonIndex;
            currentExerciseIndex = prevLesson.exercises.length - 1;
            loadExercise();
          }
        }
      });
    }

    if (nextBtn) {
      nextBtn.addEventListener('click', () => {
        const lesson = enhancedLessons[currentLessonIndex];
        if (currentExerciseIndex < lesson.exercises.length - 1) {
          currentExerciseIndex++;
          loadExercise();
        } else if (currentLessonIndex < enhancedLessons.length - 1) {
          const nextLessonIndex = currentLessonIndex + 1;
          const nextLesson = enhancedLessons[nextLessonIndex];
          if (progressData.unlockedLessons.includes(nextLesson.id)) {
            currentLessonIndex = nextLessonIndex;
            currentExerciseIndex = 0;
            loadExercise();
          } else {
            alert('Complete all exercises in the current lesson to unlock the next lesson.');
          }
        }
      });
    }

    if (retryBtn) {
      retryBtn.addEventListener('click', () => {
        resetLesson();
        highlightCurrentCharacter();
        if (typingInput) typingInput.focus();
      });
    }

    document.addEventListener('keydown', (e) => {
      if (typingInput && document.activeElement === typingInput && !typingInput.disabled && currentLevel === 'beginner') {
        highlightKey(e.code);
      }
    });

    if (progressBtn) {
      progressBtn.addEventListener('click', () => {
        updateProgressModal();
        if (progressModal) progressModal.style.display = 'block';
      });
    }

    if (closeProgress) {
      closeProgress.addEventListener('click', () => {
        if (progressModal) progressModal.style.display = 'none';
      });
    }

    window.addEventListener('click', (e) => {
      if (e.target === progressModal) {
        progressModal.style.display = 'none';
      }
    });

    const backToLessonsBtn = document.getElementById('back-to-lessons');
    if (backToLessonsBtn) {
      backToLessonsBtn.addEventListener('click', () => {
        const lessonContainer = document.querySelector('.lesson-container');
        if (lessonContainer) {
          lessonContainer.scrollIntoView({ behavior: 'smooth' });
        }
      });
    }

    // Image fade-in effect
    document.addEventListener("DOMContentLoaded", () => {
      const images = document.querySelectorAll("img");
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add("visible");
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.2 });
      images.forEach(img => observer.observe(img));
    });

    // =======================
    // GAMES SYSTEM
    // =======================

    let currentGame = null;
    let gameInterval = null;
    let gameTimeInterval = null;
    let gameScores = JSON.parse(localStorage.getItem('typingGameScores')) || {};

    // Word lists for games
    const gameWords = {
      easy: ['cat', 'dog', 'run', 'jump', 'book', 'tree', 'sun', 'moon', 'star', 'fish', 'bird', 'home', 'love', 'play', 'work', 'talk', 'walk', 'read', 'write', 'think', 'help', 'make', 'give', 'find', 'tell', 'hand', 'part', 'keep', 'call', 'good'],
      medium: ['house', 'water', 'speed', 'brain', 'quick', 'storm', 'light', 'space', 'power', 'magic', 'dream', 'peace', 'happy', 'smart', 'brave', 'strong', 'bright', 'clear', 'fresh', 'clean', 'place', 'world', 'great', 'point', 'child', 'study', 'young', 'learn', 'small', 'large'],
      hard: ['computer', 'keyboard', 'mountain', 'butterfly', 'adventure', 'challenge', 'excellent', 'wonderful', 'beautiful', 'javascript', 'development', 'programming', 'algorithm', 'function', 'variable', 'technology', 'creativity', 'experience', 'intelligence', 'performance', 'accomplish', 'determine', 'establish', 'fundamental', 'illustrate', 'knowledge', 'magnificent', 'opportunity', 'perspective', 'restaurant']
    };

    const sentences = [
      'The quick brown fox jumps over the lazy dog.',
      'Practice makes perfect when learning to type.',
      'Typing skills are essential in the modern world.',
      'Focus on accuracy first, then build up your speed.',
      'Regular practice will improve your typing abilities.',
      'Keep your fingers on the home row position.',
      'Touch typing helps reduce eye strain and fatigue.',
      'Develop muscle memory through consistent practice.',
      'Set realistic goals and track your progress daily.',
      'Take breaks to prevent repetitive strain injuries.'
    ];

    function initializeGames() {
      const gameCards = document.querySelectorAll('.game-card');
      gameCards.forEach(card => {
        card.addEventListener('click', function() {
          const gameName = this.getAttribute('data-game');
          if (gameName) {
            startGame(gameName);
          }
        });
      });

      const closeGameBtn = document.getElementById('close-game');
      if (closeGameBtn) {
        closeGameBtn.addEventListener('click', () => {
          closeGame();
        });
      }
    }

    function startGame(gameName) {
      closeGame();
      
      const gameContainer = document.getElementById('game-container');
      if (gameContainer) {
        gameContainer.classList.remove('hidden');
        
        setTimeout(() => {
          gameContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
      }
      
      currentGame = gameName;
      
      const gameCanvas = document.getElementById('game-canvas');
      if (gameCanvas) {
        gameCanvas.innerHTML = '';
      }
      
      const gameScore = document.getElementById('game-score');
      const gameTime = document.getElementById('game-time');
      const gameWpm = document.getElementById('game-wpm');
      const gameAccuracy = document.getElementById('game-accuracy');
      
      if (gameScore) gameScore.textContent = '0';
      if (gameTime) gameTime.textContent = '0s';
      if (gameWpm) gameWpm.textContent = '0';
      if (gameAccuracy) gameAccuracy.textContent = '100%';
      
      switch(gameName) {
        case 'falling-words':
          startFallingWords();
          break;
        case 'word-race':
          startWordRace();
          break;
        case 'letter-ninja':
          startLetterNinja();
          break;
        case 'typing-destroyer':
          startTypingDestroyer();
          break;
        case 'sentence-challenge':
          startSentenceChallenge();
          break;
        case 'typing-marathon':
          startTypingMarathon();
          break;
      }
    }

    function closeGame() {
      if (gameInterval) {
        clearInterval(gameInterval);
        gameInterval = null;
      }
      
      if (gameTimeInterval) {
        clearInterval(gameTimeInterval);
        gameTimeInterval = null;
      }
      
      if (currentGame) {
        const gameContainer = document.getElementById('game-container');
        if (gameContainer) {
          gameContainer.classList.add('hidden');
        }
        currentGame = null;
      }
      
      document.removeEventListener('keydown', ninjaKeyHandler);
    }

    // Game 1: Falling Words
    function startFallingWords() {
      const gameTitle = document.getElementById('game-title');
      if (gameTitle) gameTitle.textContent = '‚¨áÔ∏è Falling Words';
      
      const gameCanvas = document.getElementById('game-canvas');
      if (!gameCanvas) return;
      
      const canvasHeight = 400;
      
      let score = 0;
      let time = 0;
      let lives = 3;
      let totalTyped = 0;
      let correctTyped = 0;
      let fallingWords = [];
      let nextWordId = 0;
      
      gameCanvas.innerHTML = `
        <div style="position: relative; height: ${canvasHeight}px; border: 2px solid var(--border-subtle); border-radius: var(--radius-md); overflow: hidden; background: linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-card) 100%);">
          <div id="falling-area" style="position: relative; height: 100%; width: 100%;"></div>
          <div style="position: absolute; top: 1rem; left: 1rem; background: rgba(0,0,0,0.7); padding: 0.5rem 1rem; border-radius: 8px;">
            <span style="color: #ef4444; font-weight: 600;">‚ù§Ô∏è Lives: <span id="lives-count">${lives}</span></span>
          </div>
        </div>
        <input type="text" id="game-word-input" class="game-input" placeholder="Type the falling words..." autocomplete="off" style="margin-top: 1rem;">
      `;
      
      const fallingArea = document.getElementById('falling-area');
      const input = document.getElementById('game-word-input');
      const livesDisplay = document.getElementById('lives-count');
      
      if (input) input.focus();
      
      function createFallingWord() {
        if (!fallingArea) return;
        
        const word = gameWords.easy[Math.floor(Math.random() * gameWords.easy.length)];
        const wordElement = document.createElement('div');
        wordElement.className = 'falling-word';
        wordElement.textContent = word;
        wordElement.style.left = Math.random() * (fallingArea.offsetWidth - 100) + 'px';
        wordElement.style.top = '0px';
        wordElement.dataset.wordId = nextWordId++;
        wordElement.dataset.word = word;
        
        fallingArea.appendChild(wordElement);
        
        fallingWords.push({
          element: wordElement,
          word: word,
          top: 0,
          speed: 1 + Math.random() * 0.5
        });
      }
      
      function updateFallingWords() {
        fallingWords = fallingWords.filter(wordObj => {
          wordObj.top += wordObj.speed;
          wordObj.element.style.top = wordObj.top + 'px';
          
          if (wordObj.top > canvasHeight - 60) {
            if (wordObj.element.parentNode) {
              wordObj.element.remove();
            }
            lives--;
            if (livesDisplay) {
              livesDisplay.textContent = lives;
              livesDisplay.parentElement.style.animation = 'pulse 0.5s';
            }
            
            if (lives <= 0) {
              endGame();
            }
            return false;
          }
          return true;
        });
      }
      
      if (input) {
        input.addEventListener('input', () => {
          const typed = input.value.trim().toLowerCase();
          totalTyped++;
          
          for (let i = 0; i < fallingWords.length; i++) {
            if (fallingWords[i].word === typed) {
              score += 10;
              correctTyped += typed.length;
              
              fallingWords[i].element.style.transition = 'all 0.3s ease';
              fallingWords[i].element.style.transform = 'scale(1.5) rotate(360deg)';
              fallingWords[i].element.style.opacity = '0';
              
              setTimeout(() => {
                if (fallingWords[i] && fallingWords[i].element.parentNode) {
                  fallingWords[i].element.remove();
                }
              }, 300);
              
              fallingWords.splice(i, 1);
              
              input.value = '';
              input.style.borderColor = '#4ade80';
              setTimeout(() => { input.style.borderColor = ''; }, 200);
              
              const gameScore = document.getElementById('game-score');
              if (gameScore) gameScore.textContent = score;
              updateGameWPM();
              break;
            }
          }
        });
      }
      
      function updateGameWPM() {
        const minutes = time / 60;
        const wpm = minutes > 0 ? Math.round((correctTyped / 5) / minutes) : 0;
        const accuracy = totalTyped > 0 ? Math.round((correctTyped / totalTyped) * 100) : 100;
        
        const gameWpm = document.getElementById('game-wpm');
        const gameAccuracy = document.getElementById('game-accuracy');
        
        if (gameWpm) gameWpm.textContent = wpm;
        if (gameAccuracy) gameAccuracy.textContent = accuracy + '%';
      }
      
      function endGame() {
        clearInterval(gameInterval);
        clearInterval(gameTimeInterval);
        if (input) input.disabled = true;
        
        const gameWpm = document.getElementById('game-wpm');
        const wpmText = gameWpm ? gameWpm.textContent : '0';
        
        saveGameScore('falling-words', score, time, wpmText);
        displayHighScores();
        
        const gameAccuracy = document.getElementById('game-accuracy');
        const accText = gameAccuracy ? gameAccuracy.textContent : '100%';
        
        setTimeout(() => {
          alert(`Game Over!\n\nFinal Score: ${score}\nTime Survived: ${time}s\nWPM: ${wpmText}\nAccuracy: ${accText}`);
        }, 500);
      }
      
      for (let i = 0; i < 3; i++) {
        setTimeout(() => createFallingWord(), i * 800);
      }
      
      gameTimeInterval = setInterval(() => {
        time++;
        const gameTime = document.getElementById('game-time');
        if (gameTime) gameTime.textContent = time + 's';
      }, 1000);
      
      gameInterval = setInterval(() => {
        updateFallingWords();
        
        if (Math.random() < 0.3 && fallingWords.length < 6) {
          createFallingWord();
        }
      }, 100);
    }

    // Game 2: Word Race
    function startWordRace() {
      const gameTitle = document.getElementById('game-title');
      if (gameTitle) gameTitle.textContent = 'üèÅ Word Race';
      
      const gameCanvas = document.getElementById('game-canvas');
      if (!gameCanvas) return;
      
      const gameDuration = 60;
      let timeLeft = gameDuration;
      let score = 0;
      let wordsTyped = 0;
      let totalChars = 0;
      let correctChars = 0;
      
      gameCanvas.innerHTML = `
        <div style="text-align: center; padding: 2rem;">
          <div style="font-size: 3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 1rem;" id="time-remaining">${timeLeft}s</div>
          <div style="font-size: 2rem; padding: 2rem; background: var(--bg-card); border-radius: var(--radius-md); margin-bottom: 1rem; min-height: 100px; display: flex; align-items: center; justify-content: center; font-weight: 600; letter-spacing: 2px;" id="current-word-display">
            Ready to race...
          </div>
          <input type="text" id="race-input" class="game-input" placeholder="Type the word and press Enter..." autocomplete="off" disabled>
          <div style="margin-top: 1rem; color: var(--text-muted); font-size: 1.1rem;">
            Words typed: <span id="words-typed-count" style="color: #4ade80; font-weight: 700;">0</span>
          </div>
        </div>
      `;
      
      const wordDisplay = document.getElementById('current-word-display');
      const input = document.getElementById('race-input');
      const timeDisplay = document.getElementById('time-remaining');
      const wordsCount = document.getElementById('words-typed-count');
      
      let currentWord = '';
      
      function getRandomWord() {
        const allWords = [...gameWords.easy, ...gameWords.medium, ...gameWords.hard];
        return allWords[Math.floor(Math.random() * allWords.length)];
      }
      
      function setNewWord() {
        currentWord = getRandomWord();
        if (wordDisplay) {
          wordDisplay.textContent = currentWord;
          wordDisplay.style.color = 'var(--text-primary)';
          wordDisplay.style.transform = 'scale(1)';
        }
      }
      
      setTimeout(() => {
        setNewWord();
        if (input) {
          input.disabled = false;
          input.focus();
        }
        
        gameInterval = setInterval(() => {
          timeLeft--;
          if (timeDisplay) timeDisplay.textContent = timeLeft + 's';
          
          const gameTime = document.getElementById('game-time');
          if (gameTime) gameTime.textContent = (gameDuration - timeLeft) + 's';
          
          if (timeLeft <= 0) {
            endRace();
          }
        }, 1000);
      }, 1500);
      
      if (input) {
        input.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            const typed = input.value.trim();
            totalChars += typed.length;
            
            if (typed === currentWord) {
              score += currentWord.length * 2;
              wordsTyped++;
              correctChars += typed.length;
              
              if (wordsCount) wordsCount.textContent = wordsTyped;
              const gameScore = document.getElementById('game-score');
              if (gameScore) gameScore.textContent = score;
              
              if (wordDisplay) {
                wordDisplay.style.color = '#4ade80';
                wordDisplay.style.transform = 'scale(1.1)';
              }
              
              setTimeout(() => {
                if (wordDisplay) wordDisplay.style.transform = 'scale(1)';
                setNewWord();
              }, 200);
              
              input.value = '';
              input.style.borderColor = '#4ade80';
              setTimeout(() => { input.style.borderColor = ''; }, 200);
              
              const minutes = (gameDuration - timeLeft) / 60;
              const wpm = minutes > 0 ? Math.round((correctChars / 5) / minutes) : 0;
              const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
              
              const gameWpm = document.getElementById('game-wpm');
              const gameAccuracy = document.getElementById('game-accuracy');
              
              if (gameWpm) gameWpm.textContent = wpm;
              if (gameAccuracy) gameAccuracy.textContent = accuracy + '%';
            } else {
              input.value = '';
              input.style.borderColor = '#ef4444';
              if (wordDisplay) wordDisplay.style.color = '#ef4444';
              setTimeout(() => {
                input.style.borderColor = '';
                if (wordDisplay) wordDisplay.style.color = 'var(--text-primary)';
              }, 300);
            }
          }
        });
      }
      
      function endRace() {
        clearInterval(gameInterval);
        if (input) input.disabled = true;
        
        const gameWpm = document.getElementById('game-wpm');
        const wpmText = gameWpm ? gameWpm.textContent : '0';
        
        saveGameScore('word-race', score, gameDuration - timeLeft, wpmText);
        displayHighScores();
        
        const gameAccuracy = document.getElementById('game-accuracy');
        const accText = gameAccuracy ? gameAccuracy.textContent : '100%';
        
        setTimeout(() => {
          alert(`Race Complete!\n\nWords Typed: ${wordsTyped}\nScore: ${score}\nWPM: ${wpmText}\nAccuracy: ${accText}`);
        }, 500);
      }
    }

    // Game 3: Letter Ninja
    let ninjaKeyHandler = null;
    
    function startLetterNinja() {
      const gameTitle = document.getElementById('game-title');
      if (gameTitle) gameTitle.textContent = 'ü•∑ Letter Ninja';
      
      const gameCanvas = document.getElementById('game-canvas');
      if (!gameCanvas) return;
      
      let score = 0;
      let time = 0;
      let streak = 0;
      let maxStreak = 0;
      let hits = 0;
      let misses = 0;
      
      const letters = 'abcdefghijklmnopqrstuvwxyz'.split('');
      let currentLetter = '';
      let gameStarted = false;
      
      gameCanvas.innerHTML = `
        <div style="text-align: center; padding: 2rem;">
          <div style="font-size: 6rem; font-weight: 700; color: var(--text-primary); margin-bottom: 2rem; padding: 3rem; background: var(--bg-card); border-radius: var(--radius-md); min-height: 200px; display: flex; align-items: center; justify-content: center; text-shadow: 0 4px 8px rgba(0,0,0,0.3);" id="ninja-letter">
            Press any key
          </div>
          <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 1rem; flex-wrap: wrap;">
            <div style="background: var(--bg-card); padding: 1rem; border-radius: 8px; min-width: 120px;">
              <div style="font-size: 0.8rem; color: var(--text-muted);">Streak</div>
              <div style="font-size: 1.8rem; font-weight: 700; color: #f59e0b;" id="ninja-streak">0</div>
            </div>
            <div style="background: var(--bg-card); padding: 1rem; border-radius: 8px; min-width: 120px;">
              <div style="font-size: 0.8rem; color: var(--text-muted);">Max Streak</div>
              <div style="font-size: 1.8rem; font-weight: 700; color: #8b5cf6;" id="ninja-max-streak">0</div>
            </div>
          </div>
          <div style="color: var(--text-muted); font-size: 1.1rem;">
            Hits: <span id="ninja-hits" style="color: #4ade80; font-weight: 700;">0</span> | 
            Misses: <span id="ninja-misses" style="color: #ef4444; font-weight: 700;">0</span>
          </div>
        </div>
      `;
      
      const letterDisplay = document.getElementById('ninja-letter');
      const streakDisplay = document.getElementById('ninja-streak');
      const maxStreakDisplay = document.getElementById('ninja-max-streak');
      const hitsDisplay = document.getElementById('ninja-hits');
      const missesDisplay = document.getElementById('ninja-misses');
      
      function setNewLetter() {
        currentLetter = letters[Math.floor(Math.random() * letters.length)];
        if (letterDisplay) {
          letterDisplay.textContent = currentLetter.toUpperCase();
          letterDisplay.style.color = 'var(--text-primary)';
          letterDisplay.style.transform = 'scale(1)';
        }
      }
      
      ninjaKeyHandler = function(e) {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
          return;
        }
        
        if (!gameStarted) {
          gameStarted = true;
          setNewLetter();
          
          gameTimeInterval = setInterval(() => {
            time++;
            const gameTime = document.getElementById('game-time');
            if (gameTime) gameTime.textContent = time + 's';
          }, 1000);
          return;
        }
        
        if (e.key.toLowerCase() === currentLetter) {
          score += 10 + (streak * 2);
          hits++;
          streak++;
          
          if (streak > maxStreak) {
            maxStreak = streak;
            if (maxStreakDisplay) maxStreakDisplay.textContent = maxStreak;
          }
          
          if (letterDisplay) {
            letterDisplay.style.color = '#4ade80';
            letterDisplay.style.transform = 'scale(1.2)';
          }
          
          setTimeout(() => setNewLetter(), 300);
          
          const gameScore = document.getElementById('game-score');
          if (gameScore) gameScore.textContent = score;
          if (streakDisplay) streakDisplay.textContent = streak;
          if (hitsDisplay) hitsDisplay.textContent = hits;
          
        } else if (e.key.length === 1 && /^[a-zA-Z]$/.test(e.key)) {
          misses++;
          streak = 0;
          
          if (letterDisplay) {
            letterDisplay.style.color = '#ef4444';
            letterDisplay.style.transform = 'scale(0.9)';
          }
          
          if (missesDisplay) missesDisplay.textContent = misses;
          if (streakDisplay) streakDisplay.textContent = streak;
          
          setTimeout(() => {
            if (letterDisplay) {
              letterDisplay.style.color = 'var(--text-primary)';
              letterDisplay.style.transform = 'scale(1)';
            }
          }, 300);
        }
        
        const accuracy = (hits + misses) > 0 ? Math.round((hits / (hits + misses)) * 100) : 100;
        const gameAccuracy = document.getElementById('game-accuracy');
        if (gameAccuracy) gameAccuracy.textContent = accuracy + '%';
        
        const minutes = time / 60;
        const wpm = minutes > 0 ? Math.round((hits / 5) / minutes) : 0;
        const gameWpm = document.getElementById('game-wpm');
        if (gameWpm) gameWpm.textContent = wpm;
      };
      
      document.addEventListener('keydown', ninjaKeyHandler);
    }

    // Game 4: Typing Destroyer
    function startTypingDestroyer() {
      const gameTitle = document.getElementById('game-title');
      if (gameTitle) gameTitle.textContent = 'üí• Typing Destroyer';
      
      const gameCanvas = document.getElementById('game-canvas');
      if (!gameCanvas) return;
      
      let score = 0;
      let time = 0;
      let combo = 0;
      let destroyed = 0;
      let totalTyped = 0;
      let correctTyped = 0;
      
      gameCanvas.innerHTML = `
        <div style="position: relative; padding: 2rem;">
          <div style="position: absolute; top: 1rem; right: 1rem; background: var(--primary-gradient); color: white; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 700; font-size: 1.5rem; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);">
            COMBO: <span id="destroyer-combo">0</span>x
          </div>
          <div id="words-container" style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; min-height: 220px; margin-bottom: 2rem; padding-top: 3rem;">
          </div>
          <input type="text" id="destroyer-input" class="game-input" placeholder="Type words to destroy them..." autocomplete="off">
          <div style="text-align: center; margin-top: 1rem; color: var(--text-muted); font-size: 1.1rem;">
            Destroyed: <span id="destroyed-count" style="color: #4ade80; font-weight: 700; font-size: 1.3rem;">0</span>
          </div>
        </div>
      `;
      
      const wordsContainer = document.getElementById('words-container');
      const input = document.getElementById('destroyer-input');
      const comboDisplay = document.getElementById('destroyer-combo');
      const destroyedDisplay = document.getElementById('destroyed-count');
      
      let activeWords = [];
      
      function createWord() {
        if (!wordsContainer) return;
        
        const allWords = [...gameWords.medium, ...gameWords.hard];
        const word = allWords[Math.floor(Math.random() * allWords.length)];
        
        const wordElement = document.createElement('div');
        wordElement.style.cssText = `
          background: var(--primary-gradient);
          color: white;
          padding: 0.75rem 1.5rem;
          border-radius: var(--radius-sm);
          font-weight: 600;
          font-size: 1.2rem;
          box-shadow: var(--shadow-md);
          animation: pulse 2s infinite;
          transition: all 0.3s ease;
          cursor: default;
        `;
        wordElement.textContent = word;
        wordElement.dataset.word = word;
        
        wordsContainer.appendChild(wordElement);
        activeWords.push({ element: wordElement, word: word });
      }
      
      for (let i = 0; i < 4; i++) {
        createWord();
      }
      
      if (input) input.focus();
      
      if (input) {
        input.addEventListener('input', () => {
          const typed = input.value.trim().toLowerCase();
          
          for (let i = 0; i < activeWords.length; i++) {
            if (activeWords[i].word === typed) {
              const wordLen = typed.length;
              score += wordLen * 5 * (combo + 1);
              correctTyped += wordLen;
              destroyed++;
              combo++;
              
              activeWords[i].element.style.animation = 'none';
              activeWords[i].element.style.transform = 'scale(1.5) rotate(360deg)';
              activeWords[i].element.style.opacity = '0';
              
              setTimeout(() => {
                if (activeWords[i] && activeWords[i].element.parentNode) {
                  activeWords[i].element.remove();
                }
              }, 300);
              
              activeWords.splice(i, 1);
              input.value = '';
              
              const gameScore = document.getElementById('game-score');
              if (gameScore) gameScore.textContent = score;
              if (comboDisplay) comboDisplay.textContent = combo;
              if (destroyedDisplay) destroyedDisplay.textContent = destroyed;
              
              input.style.borderColor = '#4ade80';
              setTimeout(() => { input.style.borderColor = ''; }, 200);
              
              createWord();
              
              const minutes = time / 60;
              const wpm = minutes > 0 ? Math.round((correctTyped / 5) / minutes) : 0;
              totalTyped += wordLen;
              const accuracy = totalTyped > 0 ? Math.round((correctTyped / totalTyped) * 100) : 100;
              
              const gameWpm = document.getElementById('game-wpm');
              const gameAccuracy = document.getElementById('game-accuracy');
              
              if (gameWpm) gameWpm.textContent = wpm;
              if (gameAccuracy) gameAccuracy.textContent = accuracy + '%';
              break;
            }
          }
        });
        
        let comboTimeout;
        input.addEventListener('keydown', () => {
          clearTimeout(comboTimeout);
          comboTimeout = setTimeout(() => {
            combo = 0;
            if (comboDisplay) comboDisplay.textContent = combo;
          }, 3000);
        });
      }
      
      gameTimeInterval = setInterval(() => {
        time++;
        const gameTime = document.getElementById('game-time');
        if (gameTime) gameTime.textContent = time + 's';
        
        if (Math.random() < 0.2 && activeWords.length < 8) {
          createWord();
        }
      }, 1000);
    }

    // Game 5: Sentence Challenge
    function startSentenceChallenge() {
      const gameTitle = document.getElementById('game-title');
      if (gameTitle) gameTitle.textContent = 'üìù Sentence Challenge';
      
      const gameCanvas = document.getElementById('game-canvas');
      if (!gameCanvas) return;
      
      let score = 0;
      let time = 0;
      let sentencesCompleted = 0;
      let totalChars = 0;
      let correctChars = 0;
      
      gameCanvas.innerHTML = `
        <div style="text-align: center; padding: 2rem;">
          <div style="font-size: 1.5rem; padding: 2rem; background: var(--bg-card); border-radius: var(--radius-md); margin-bottom: 1rem; line-height: 1.8; min-height: 120px; display: flex; align-items: center; justify-content: center;" id="sentence-display">
            Loading...
          </div>
          <input type="text" id="sentence-input" class="game-input" placeholder="Type the sentence exactly..." autocomplete="off">
          <div style="margin-top: 1rem; color: var(--text-muted); font-size: 1.1rem;">
            Sentences completed: <span id="sentences-count" style="color: #4ade80; font-weight: 700; font-size: 1.3rem;">0</span>
          </div>
        </div>
      `;
      
      const sentenceDisplay = document.getElementById('sentence-display');
      const input = document.getElementById('sentence-input');
      const sentencesCount = document.getElementById('sentences-count');
      
      let currentSentence = '';
      
      function setNewSentence() {
        currentSentence = sentences[Math.floor(Math.random() * sentences.length)];
        if (sentenceDisplay) {
          sentenceDisplay.textContent = currentSentence;
          sentenceDisplay.style.color = 'var(--text-primary)';
        }
        if (input) input.value = '';
      }
      
      setNewSentence();
      if (input) input.focus();
      
      if (input) {
        input.addEventListener('input', () => {
          const typed = input.value;
          totalChars = Math.max(totalChars, typed.length);
          
          let correct = 0;
          for (let i = 0; i < typed.length && i < currentSentence.length; i++) {
            if (typed[i] === currentSentence[i]) {
              correct++;
            }
          }
          correctChars = Math.max(correctChars, correct);
          
          if (typed === currentSentence) {
            score += currentSentence.length * 3;
            sentencesCompleted++;
            
            const gameScore = document.getElementById('game-score');
            if (gameScore) gameScore.textContent = score;
            if (sentencesCount) sentencesCount.textContent = sentencesCompleted;
            
            input.style.borderColor = '#4ade80';
            if (sentenceDisplay) {
              sentenceDisplay.style.color = '#4ade80';
              sentenceDisplay.style.transform = 'scale(1.05)';
            }
            
            setTimeout(() => {
              input.style.borderColor = '';
              if (sentenceDisplay) sentenceDisplay.style.transform = 'scale(1)';
              setNewSentence();
            }, 800);
          }
          
          const minutes = time / 60;
          const wpm = minutes > 0 ? Math.round((correctChars / 5) / minutes) : 0;
          const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
          
          const gameWpm = document.getElementById('game-wpm');
          const gameAccuracy = document.getElementById('game-accuracy');
          
          if (gameWpm) gameWpm.textContent = wpm;
          if (gameAccuracy) gameAccuracy.textContent = accuracy + '%';
        });
      }
      
      gameTimeInterval = setInterval(() => {
        time++;
        const gameTime = document.getElementById('game-time');
        if (gameTime) gameTime.textContent = time + 's';
      }, 1000);
    }

    // Game 6: Typing Marathon
    function startTypingMarathon() {
      const gameTitle = document.getElementById('game-title');
      if (gameTitle) gameTitle.textContent = 'üèÉ Typing Marathon';
      
      const gameCanvas = document.getElementById('game-canvas');
      if (!gameCanvas) return;
      
      let score = 0;
      let time = 0;
      let wordsTyped = 0;
      let totalChars = 0;
      let correctChars = 0;
      
      gameCanvas.innerHTML = `
        <div style="text-align: center; padding: 2rem;">
          <div style="font-size: 2rem; font-weight: 700; color: var(--text-primary); margin-bottom: 2rem; animation: pulse 2s infinite;">
            üèÉ Keep Going! Type Forever! üèÉ
          </div>
          <div style="font-size: 2rem; padding: 2rem; background: var(--bg-card); border-radius: var(--radius-md); margin-bottom: 1rem; min-height: 100px; display: flex; align-items: center; justify-content: center; font-weight: 600;" id="marathon-word">
            Ready...
          </div>
          <input type="text" id="marathon-input" class="game-input" placeholder="Type the word and press Enter..." autocomplete="off" disabled>
          <div style="margin-top: 1rem;">
            <div style="display: inline-block; background: var(--primary-gradient); color: white; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 700; font-size: 1.2rem; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);">
              Marathon Progress: <span id="marathon-progress">0</span> words
            </div>
          </div>
        </div>
      `;
      
      const wordDisplay = document.getElementById('marathon-word');
      const input = document.getElementById('marathon-input');
      const progressDisplay = document.getElementById('marathon-progress');
      
      let currentWord = '';
      
      function getRandomWord() {
        const allWords = [...gameWords.easy, ...gameWords.medium, ...gameWords.hard];
        return allWords[Math.floor(Math.random() * allWords.length)];
      }
      
      function setNewWord() {
        currentWord = getRandomWord();
        if (wordDisplay) {
          wordDisplay.textContent = currentWord;
          wordDisplay.style.color = 'var(--text-primary)';
          wordDisplay.style.transform = 'scale(1)';
        }
      }
      
      setTimeout(() => {
        setNewWord();
        if (input) {
          input.disabled = false;
          input.focus();
        }
        
        gameTimeInterval = setInterval(() => {
          time++;
          const gameTime = document.getElementById('game-time');
          if (gameTime) gameTime.textContent = time + 's';
        }, 1000);
      }, 1000);
      
      if (input) {
        input.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            const typed = input.value.trim();
            totalChars += typed.length;
            
            if (typed === currentWord) {
              score += currentWord.length * 2;
              wordsTyped++;
              correctChars += typed.length;
              
              const gameScore = document.getElementById('game-score');
              if (gameScore) gameScore.textContent = score;
              if (progressDisplay) progressDisplay.textContent = wordsTyped;
              
              if (wordDisplay) {
                wordDisplay.style.color = '#4ade80';
                wordDisplay.style.transform = 'scale(1.1)';
              }
              
              setTimeout(() => {
                setNewWord();
              }, 200);
              
              input.value = '';
              input.style.borderColor = '#4ade80';
              setTimeout(() => { input.style.borderColor = ''; }, 200);
              
              const minutes = time / 60;
              const wpm = minutes > 0 ? Math.round((correctChars / 5) / minutes) : 0;
              const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
              
              const gameWpm = document.getElementById('game-wpm');
              const gameAccuracy = document.getElementById('game-accuracy');
              
              if (gameWpm) gameWpm.textContent = wpm;
              if (gameAccuracy) gameAccuracy.textContent = accuracy + '%';
            } else {
              input.value = '';
              input.style.borderColor = '#ef4444';
              if (wordDisplay) wordDisplay.style.color = '#ef4444';
              setTimeout(() => {
                input.style.borderColor = '';
                if (wordDisplay) wordDisplay.style.color = 'var(--text-primary)';
              }, 300);
            }
          }
        });
      }
    }

    // Save and display high scores
    function saveGameScore(gameName, score, time, wpm) {
      if (!gameScores[gameName]) {
        gameScores[gameName] = [];
      }
      
      gameScores[gameName].push({
        score: score,
        date: new Date().toLocaleDateString(),
        time: time + 's',
        wpm: wpm
      });
      
      gameScores[gameName].sort((a, b) => b.score - a.score);
      gameScores[gameName] = gameScores[gameName].slice(0, 5);
      
      localStorage.setItem('typingGameScores', JSON.stringify(gameScores));
    }

    function displayHighScores() {
      const container = document.getElementById('high-scores-container');
      if (!container) return;
      
      container.innerHTML = '';
      
      const gameNames = {
        'falling-words': '‚¨áÔ∏è Falling Words',
        'word-race': 'üèÅ Word Race',
        'letter-ninja': 'ü•∑ Letter Ninja',
        'typing-destroyer': 'üí• Typing Destroyer',
        'sentence-challenge': 'üìù Sentence Challenge',
        'typing-marathon': 'üèÉ Typing Marathon'
      };
      
      Object.keys(gameNames).forEach(gameKey => {
        const scores = gameScores[gameKey] || [];
        
        const scoreCard = document.createElement('div');
        scoreCard.style.cssText = `
          background: var(--bg-card);
          padding: 1.5rem;
          border-radius: var(--radius-md);
          border: 1px solid var(--border-subtle);
        `;
        
        scoreCard.innerHTML = `
          <h3 style="margin-bottom: 1rem; color: var(--text-primary);">${gameNames[gameKey]}</h3>
          ${scores.length > 0 ? `
            <div style="font-size: 0.9rem;">
              ${scores.map((s, i) => `
                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-subtle);">
                  <span style="color: var(--text-muted);">#${i + 1}</span>
                  <span style="color: var(--text-secondary); font-weight: 600;">${s.score} pts</span>
                  <span style="color: var(--text-muted); font-size: 0.8rem;">${s.wpm} | ${s.time}</span>
                </div>
              `).join('')}
            </div>
          ` : `
            <div style="color: var(--text-muted); font-style: italic; text-align: center; padding: 1rem;">
              No scores yet. Play to set a record!
            </div>
          `}
        `;
        
        container.appendChild(scoreCard);
      });
    }

    // Initialize
    function initializeApp() {
      if (!progressData.unlockedLessons || progressData.unlockedLessons.length === 0) {
        progressData.unlockedLessons = [1];
        localStorage.setItem('typingProgress', JSON.stringify(progressData));
      }

      populateLessonsGrid();
      updateProgressDisplay();
      updateSidebarStats();
      initializeGames();
      displayHighScores();

      const firstUnlockedId = progressData.unlockedLessons[0];
      const idx = lessonIndexById(firstUnlockedId);
      if (idx >= 0) {
        loadLesson(idx);
      } else {
        loadLesson(0);
      }
      
      console.log(progressData)('SoftFingers Professional Typing Lessons initialized successfully.');
    }

    // Run initialization when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      initializeApp();
    }
		  function myFunction() {
    console.log("Hello, world!");
  }}
</script>
</body>
</html>
